<!DOCTYPE html>
<html>

<head>
    <title>Puissance 4</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        
        canvas {
            border: 1px solid black;
        }
    </style>
</head>

<body>
    <canvas id="gameCanvas" width="420" height="360"></canvas>

    <script src="assets/lib/Interface.js"></script>
    <script src="assets/lib/MinMax.js"></script>
    <script src="assets/js/Puissance4Implementation.js"></script>
    <script src="assets/js/index.js"></script>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const GRID_SIZE = 60;
        const COLS = 7;
        const ROWS = 6;
        const PLAYER1_COLOR = "red";
        const PLAYER2_COLOR = "blue";

        let currentPlayer = 1;
        let grid = [];

        // Initialisation de la grille vide
        function initializeGrid() {
            for (let row = 0; row < ROWS; row++) {
                grid[row] = [];
                for (let col = 0; col < COLS; col++) {
                    grid[row][col] = 0;
                }
            }
        }

        // Dessine la grille et les pièces
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let row = 0; row < ROWS; row++) {
                for (let col = 0; col < COLS; col++) {
                    drawPiece(col, row, grid[row][col]);
                }
            }

            drawGrid();
        }

        // Dessine une pièce à une position donnée
        function drawPiece(col, row, player) {
            const x = col * GRID_SIZE + GRID_SIZE / 2;
            const y = canvas.height - ((ROWS - 1 - row) * GRID_SIZE + GRID_SIZE / 2);
            const radius = GRID_SIZE / 2 - 5;

            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);

            switch (player) {
                case 1:
                    ctx.fillStyle = PLAYER1_COLOR;
                    break;

                case 2:
                    ctx.fillStyle = PLAYER2_COLOR;
                    break;

                default:
                    ctx.fillStyle = "grey";
                    break;
            }

            ctx.fill();
            ctx.closePath();
        }

        // Dessine la grille
        function drawGrid() {
            for (let row = 0; row < ROWS; row++) {
                for (let col = 0; col < COLS; col++) {
                    ctx.beginPath();
                    ctx.rect(col * GRID_SIZE, canvas.height - (row * GRID_SIZE) - GRID_SIZE, GRID_SIZE, GRID_SIZE);
                    ctx.strokeStyle = "black";
                    ctx.stroke();
                    ctx.closePath();
                }
            }
        }

        // Gère le clic de souris pour placer une pièce
        function handleClick(event) {
            const rect = canvas.getBoundingClientRect();
            const offsetX = event.clientX - rect.left;
            const col = Math.floor(offsetX / GRID_SIZE);

            if (grid[0][col] === 0) {
                // grid[row][col] = currentPlayer;
                // currentPlayer = currentPlayer === 1 ? 2 : 1;
                let line = ROWS - 1;
                while (line >= 0 && grid[line][col] != 0) {
                    line--;
                }

                grid[line][col] = currentPlayer;

                grid = getNextMove(grid)

                draw();

                const winner = checkWinner();
                if (winner !== 0) {
                    announceWinner(winner);
                }
            }
        }

        // Annonce le gagnant
        function announceWinner(winner) {
            const message = winner === 1 ? "Joueur 1 a gagné !" : "Joueur 2 a gagné !";
            alert(message);
            // Vous pouvez également utiliser une boîte de dialogue personnalisée ou un élément HTML pour afficher le message d'annonce.
        }

        // Vérifie s'il y a un gagnant
        function checkWinner() {
            // Vérification horizontale
            for (let row = 0; row < ROWS; row++) {
                for (let col = 0; col <= COLS - 4; col++) {
                    const player = grid[row][col];
                    if (player !== 0 &&
                        grid[row][col + 1] === player &&
                        grid[row][col + 2] === player &&
                        grid[row][col + 3] === player) {
                        return player; // On a trouvé un gagnant, on retourne le numéro du joueur
                    }
                }
            }

            // Vérification verticale
            for (let row = 0; row <= ROWS - 4; row++) {
                for (let col = 0; col < COLS; col++) {
                    const player = grid[row][col];
                    if (player !== 0 &&
                        grid[row + 1][col] === player &&
                        grid[row + 2][col] === player &&
                        grid[row + 3][col] === player) {
                        return player; // On a trouvé un gagnant, on retourne le numéro du joueur
                    }
                }
            }

            // Vérification diagonale (ascendante: /)
            for (let row = 3; row < ROWS; row++) {
                for (let col = 0; col <= COLS - 4; col++) {
                    const player = grid[row][col];
                    if (player !== 0 &&
                        grid[row - 1][col + 1] === player &&
                        grid[row - 2][col + 2] === player &&
                        grid[row - 3][col + 3] === player) {
                        return player; // On a trouvé un gagnant, on retourne le numéro du joueur
                    }
                }
            }

            // Vérification diagonale (descendante: \)
            for (let row = 0; row <= ROWS - 4; row++) {
                for (let col = 0; col <= COLS - 4; col++) {
                    const player = grid[row][col];
                    if (player !== 0 &&
                        grid[row + 1][col + 1] === player &&
                        grid[row + 2][col + 2] === player &&
                        grid[row + 3][col + 3] === player) {
                        return player; // On a trouvé un gagnant, on retourne le numéro du joueur
                    }
                }
            }

            return 0; // Aucun gagnant trouvé
        }


        // Initialiser le jeu
        function initGame() {
            initializeGrid();
            draw();
            canvas.addEventListener("click", handleClick);
        }

        initGame();
    </script>
</body>

</html>